<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pizzas para Venda | Card√°pio Online</title>
    <meta name="description" content="Veja todas as pizzas dispon√≠veis para venda. Card√°pio online com fotos, ingredientes e pre√ßos de pizzas pequenas, m√©dias e grandes.">
    <style>
        /* ---------- RESET B√ÅSICO ---------- */
        *{box-sizing:border-box;margin:0;padding:0}

        body {
            background: #f0f0f0;
            font-family: Arial, sans-serif;
        }

        /* ---------- TOPO FIXO ---------- */
        .subtotal {
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1100;
            width: 100%;             /* 100% tela, limitado pelo max‚Äëwidth */
            max-width: 350px;
            margin: 8px auto 0 auto; /* margem superior p/ respirar em telas largas */
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 1px 6px rgba(0,0,0,0.08);
            padding: 12px;
            display:none;            /* s√≥ aparece quando houver itens */
        }

        /* bot√£o de remover item (modal e subtotal r√°pido) */
        .btnDelSubtotal {
            background: transparent;     /* sem fundo ‚Äì fica s√≥ o emoji */
            border: none;
            font-size: 18px;
            cursor: pointer;
            margin-left: 6px;
        }

        .subtotal h3 {font-size:1.1rem;margin-bottom:8px}
        .subtotal ul {padding-left:18px;font-size:1rem}
        .subtotal-total {font-weight:bold;margin-top:8px}

        /* empurra o conte√∫do quando subtotal est√° vis√≠vel */
        body.comSubtotal main{margin-top:120px}

        /* ---------- H1 VISUALMENTE OCULTO (SEO) ---------- */
        .sr-only {
            position: absolute !important;
            width: 1px; height: 1px;
            padding: 0; margin: -1px;
            overflow: hidden;
            clip: rect(0,0,0,0);
            border: 0;
        }

        /* ---------- CARDS ---------- */
        main {
            max-width: 900px;
            margin: 0 auto;
            padding: 16px;
        }
        .pizza-list {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }
        article.pizza-card{
            background:#fff;
            border-radius:8px;
            box-shadow:0 1px 6px rgba(0,0,0,.08);
            width:100%;
            max-width:320px;
            padding:16px;
            display:flex;flex-direction:column;align-items:center;
            transition:box-shadow .2s;
        }
        article.pizza-card:hover{box-shadow:0 4px 16px rgba(0,0,0,.13)}
        .pizza-card img{
            width:100%;max-width:240px;height:180px;object-fit:cover;
            border-radius:6px;margin-bottom:10px;background:#eee;cursor:pointer;
        }
        .pizza-card h2{font-size:1.3rem;margin-bottom:8px;text-align:center}

        /* ---------- MODAL GEN√âRICO ---------- */
        .modal-bg{
            display:none;position:fixed;z-index:1000;inset:0;
            background:rgba(0,0,0,.5);align-items:center;justify-content:center;
        }
        .modal-bg.active{display:flex}
        .modal{
            background:#fff;border-radius:10px;padding:24px 18px;
            max-width:350px;width:95vw;box-shadow:0 4px 24px rgba(0,0,0,.18);
            position:relative;text-align:center;
        }
        .modal img{width:90%;max-width:220px;height:140px;object-fit:cover;border-radius:6px;margin-bottom:10px;background:#eee}
        .modal .fechar-modal{
            position:absolute;top:10px;right:10px;width:32px;height:32px;
            border:none;border-radius:50%;background:#e53935;color:#fff;font-size:1.5rem;cursor:pointer;
            display:flex;align-items:center;justify-content:center;
        }
        .precos-modal{margin-bottom:10px;text-align:left}
        .precos-modal button{margin-left:8px;background:#43a047;color:#fff;border:none;border-radius:4px;padding:2px 10px;cursor:pointer}
        .qtdInput{width:40px;text-align:center;margin:0 5px}
        .btnMenos,.btnMais{background:#eee;color:#333;border:none;border-radius:4px;padding:2px 8px;font-size:1.1em;cursor:pointer}
        .btnDelSubtotal{background:#e53935;color:#fff;border:none;border-radius:4px;padding:2px 8px;margin-left:8px;cursor:pointer}

        /* ---------- RESPONSIVO ---------- */
        @media (max-width:700px){
            .pizza-list{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
            article.pizza-card{padding:8px;min-width:140px}
            .pizza-card img{height:120px}
            .subtotal{max-width:98vw;margin:0 auto;border-radius:0 0 8px 8px}
        }
    </style>
</head>
<body>
    <!-- H1 escondido para SEO -->
    <h1 class="sr-only">ViSa a Melhor Pizzaria</h1>

    <!-- Subtotal fixo -->
    <div class="subtotal" id="subtotalBox">
        <h3>Subtotal</h3>
        <ul id="subtotalList"></ul>
        <div class="subtotal-total" id="subtotalTotal"></div>
        <button id="btnEnviarZapSubtotal" style="margin-top:10px;background:#25d366;color:#fff;">Enviar Pedido no WhatsApp</button>
    </div>

    <!-- Conte√∫do principal -->
    <main>
        <section class="pizza-list" id="pizzaList"></section>
    </main>

    <!-- Modais -->
    <div class="modal-bg" id="modalBg">
        <div class="modal" id="modalPizza">
            <button class="fechar-modal" id="fecharModal" aria-label="Fechar detalhes">-</button>
            <img id="modalImg" src="" alt="">
            <h2 id="modalNome"></h2>
            <div class="precos-modal" id="modalPrecos"></div>
            <div><strong>Ingredientes:</strong><ul id="modalIngredientes"></ul></div>
        </div>
    </div>

    <div class="modal-bg" id="modalSubtotalBg">
        <div class="modal" id="modalSubtotal">
            <button class="fechar-modal" id="fecharSubtotalModal" aria-label="Fechar subtotal">-</button>
            <h3>Subtotal</h3>
            <ul id="modalSubtotalList"></ul>
            <div class="subtotal-total" id="modalSubtotalTotal"></div>
            <button id="btnAdicionarCarrinho" style="margin:10px 5px 0 0;">Adicionar ao Carrinho</button>
            <button id="btnEnviarZap" style="margin:10px 0 0 5px;background:#25d366;color:#fff;">Enviar Pedido no WhatsApp</button>
        </div>
    </div>

<script>
    /* ---------------- VARI√ÅVEIS --------------- */
    let subtotal=[];

    /* --------------- FUN√á√ïES --------------- */
    function atualizarSubtotal () {
        const subtotalBox   = document.getElementById('subtotalBox');
        const subtotalList  = document.getElementById('subtotalList');
        const subtotalTotal = document.getElementById('subtotalTotal');

        /* se n√£o houver itens, some com o box e retire a margem extra do <main> */
        if (subtotal.length === 0) {
            subtotalBox.style.display = 'none';
            document.body.classList.remove('comSubtotal');
            return;
        }

        /* mostra o box e empurra o conte√∫do para baixo */
        subtotalBox.style.display = 'block';
        document.body.classList.add('comSubtotal');

        /* monta a lista com bot√£o üóëÔ∏è */
        subtotalList.innerHTML = '';
        let total = 0;
        subtotal.forEach((item, idx) => {
            subtotalList.innerHTML += `
                <li>
                    ${item.nome} (${item.tamanho}): R$ ${item.valor}
                    <button type="button" class="btnDelSubtotal" data-idx="${idx}">üóëÔ∏è</button>
                </li>`;
            total += parseFloat(item.valor.replace(',', '.')) || 0;
        });
        subtotalTotal.textContent = 'Total: R$ ' + total.toFixed(2).replace('.', ',');

        /* adiciona eventos de remo√ß√£o */
        document.querySelectorAll('.btnDelSubtotal').forEach(btn => {
            btn.onclick = function () {
                const idx = this.getAttribute('data-idx');
                subtotal.splice(idx, 1);   // remove do array
                atualizarSubtotal();       // redesenha a lista e total
            };
        });
    }


    function mostrarSubtotalModal(){
        const bg=document.getElementById('modalSubtotalBg');
        const list=document.getElementById('modalSubtotalList');
        const totalEl=document.getElementById('modalSubtotalTotal');
        list.innerHTML='';
        let total=0;
        subtotal.forEach((item,idx)=>{
            list.innerHTML+=`<li>${item.nome} (${item.tamanho}): R$ ${item.valor} <button class="btnDelSubtotal" data-idx="${idx}">üóëÔ∏è</button></li>`;
            total+=parseFloat(item.valor.replace(',','.'))||0;
        });
        totalEl.textContent='Total: R$ '+total.toFixed(2).replace('.',',');
        bg.classList.add('active');
        document.querySelectorAll('.btnDelSubtotal').forEach(btn=>{
            btn.onclick=function(){
                subtotal.splice(this.dataset.idx,1);
                atualizarSubtotal();
                mostrarSubtotalModal();
            }
        });
    }

    function fecharSubtotalModal(){document.getElementById('modalSubtotalBg').classList.remove('active');}

    function abrirModal(pizza){
        document.getElementById('modalImg').src='https://visa-pizzaria-backend.onrender.com'+pizza.imagem;
        document.getElementById('modalImg').alt='Pizza '+pizza.nome;
        document.getElementById('modalNome').textContent=pizza.nome;

        const tamanhos=[
            {nome:'Pequena',valor:pizza.preco.pequeno||'0'},
            {nome:'M√©dia',valor:pizza.preco.medio||'0'},
            {nome:'Grande',valor:pizza.preco.grande||'0'}
        ];
        let html='';
        tamanhos.forEach((t,idx)=>{
            html+=`<div style="display:flex;align-items:center;margin-bottom:8px;">
                <span style="width:80px;"><strong>${t.nome}:</strong> R$ ${t.valor}</span>
                <button type="button" class="btnMenos" data-idx="${idx}">-</button>
                <input type="number" min="0" value="0" class="qtdInput" data-idx="${idx}">
                <button type="button" class="btnMais" data-idx="${idx}">+</button>
                <button type="button" class="btnAddSubtotal" data-idx="${idx}" style="margin-left:10px;">Adicionar</button>
            </div>`;
        });
        document.getElementById('modalPrecos').innerHTML=html;
        document.getElementById('modalIngredientes').innerHTML=pizza.ingredientes.split(',').map(i=>i.trim()).join(', ');
        document.getElementById('modalBg').classList.add('active');

        document.querySelectorAll('.btnMais').forEach(btn=>{btn.onclick=()=>{
            const input=document.querySelector(`.qtdInput[data-idx="${btn.dataset.idx}"]`);
            input.value=parseInt(input.value)+1;
        }});
        document.querySelectorAll('.btnMenos').forEach(btn=>{btn.onclick=()=>{
            const input=document.querySelector(`.qtdInput[data-idx="${btn.dataset.idx}"]`);
            input.value=Math.max(0,parseInt(input.value)-1);
        }});
        document.querySelectorAll('.btnAddSubtotal').forEach(btn=>{btn.onclick=()=>{
            const idx=btn.dataset.idx;
            const input=document.querySelector(`.qtdInput[data-idx="${idx}"]`);
            const qtd=parseInt(input.value);
            if(qtd>0){
                for(let i=0;i<qtd;i++){adicionarSubtotal(pizza.nome,tamanhos[idx].nome,tamanhos[idx].valor);}  
                fecharModal();mostrarSubtotalModal();
            }else alert('Escolha uma quantidade maior que zero!');
        }});
    }

    function fecharModal(){document.getElementById('modalBg').classList.remove('active');}

    function adicionarSubtotal(nome,tamanho,valor){
        subtotal.push({nome,tamanho,valor});
        atualizarSubtotal();
    }

    function enviarPedidoZap(){
        if(subtotal.length===0)return;
        let msg="Ol√°! Quero pedir:\n";
        subtotal.forEach(item=>msg+=`- ${item.nome} (${item.tamanho}): R$ ${item.valor}\n`);
        let total=subtotal.reduce((acc,i)=>acc+(parseFloat(i.valor.replace(',','.'))||0),0);
        msg+=`Total: R$ ${total.toFixed(2).replace('.',',')}`;
        window.open(`https://wa.me/5511995424085?text=${encodeURIComponent(msg)}`,'_blank');
    }

    async function carregarPizzas(){
        const resp=await fetch('https://visa-pizzaria-backend.onrender.com/api/pizzas');
        const pizzas=await resp.json();
        const lista=document.getElementById('pizzaList');
        lista.innerHTML='';
        pizzas.forEach((p,idx)=>{
            lista.innerHTML+=`<article class="pizza-card" itemscope itemtype="https://schema.org/Product">
                ${p.imagem?`<img src="https://visa-pizzaria-backend.onrender.com${p.imagem}" alt="Pizza ${p.nome}" itemprop="image" data-idx="${idx}" onerror="setTimeout(()=>{this.src='https://visa-pizzaria-backend.onrender.com${p.imagem}';},4000)">`:`<div style="width:240px;height:180px;background:#eee;display:flex;align-items:center;justify-content:center;">Sem imagem</div>`}
                <h2 itemprop="name">${p.nome}</h2>
            </article>`;
        });
        document.querySelectorAll('.pizza-card img').forEach(img=>img.addEventListener('click',()=>abrirModal(pizzas[img.dataset.idx])));
    }

    /* --------------- EVENTOS INICIAIS --------------- */
    document.addEventListener('DOMContentLoaded',()=>{
        document.getElementById('fecharModal').onclick=fecharModal;
        document.getElementById('modalBg').onclick=e=>{if(e.target===e.currentTarget)fecharModal()};

        document.getElementById('fecharSubtotalModal').onclick=fecharSubtotalModal;
        document.getElementById('modalSubtotalBg').onclick=e=>{if(e.target===e.currentTarget)fecharSubtotalModal()};

        document.getElementById('btnAdicionarCarrinho').onclick=()=>{fecharSubtotalModal();alert('Itens adicionados ao carrinho!');};
        document.getElementById('btnEnviarZap').onclick=enviarPedidoZap;
        document.getElementById('btnEnviarZapSubtotal').onclick=enviarPedidoZap;

        carregarPizzas();
    });
</script>
</body>
</html>
