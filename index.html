<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pizzas para Venda | Card√°pio Online</title>
    <meta name="description" content="Veja todas as pizzas dispon√≠veis para venda. Card√°pio online com fotos, ingredientes e pre√ßos de pizzas pequenas, m√©dias e grandes.">
    <style>
        body { background: #f0f0f0; font-family: Arial, sans-serif; margin: 0; padding: 0; }
        main { max-width: 900px; margin: 0 auto; padding: 16px; }
        h1 { text-align: center; margin: 24px 0 16px 0; font-size: 2rem; }
        .pizza-list { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; }
        article.pizza-card {
            background: #fff; border-radius: 8px; box-shadow: 0 1px 6px rgba(0,0,0,0.08);
            width: 100%; max-width: 320px; padding: 16px;
            display: flex; flex-direction: column; align-items: center; transition: box-shadow 0.2s;
        }
        article.pizza-card:hover { box-shadow: 0 4px 16px rgba(0,0,0,0.13); }
        .pizza-card img {
            width: 100%; max-width: 240px; height: 180px; object-fit: cover;
            border-radius: 6px; margin-bottom: 10px; background: #eee; cursor: pointer;
        }
        .pizza-card h2 { margin: 0 0 8px 0; font-size: 1.3rem; text-align: center; }
        /* Modal */
        .modal-bg { display: none; position: fixed; z-index: 1000; inset: 0; background: rgba(0,0,0,0.5); align-items: center; justify-content: center; }
        .modal-bg.active { display: flex; }
        .modal {
            background: #fff; border-radius: 10px; padding: 24px 18px;
            max-width: 350px; width: 95vw; box-shadow: 0 4px 24px rgba(0,0,0,0.18);
            position: relative; text-align: center;
        }
        .modal img {
            width: 90%; max-width: 220px; height: 140px; object-fit: cover;
            border-radius: 6px; margin-bottom: 10px; background: #eee;
        }
        .fechar-modal {
            position: absolute; top: 10px; right: 10px;
            background: #e53935; color: #fff; border: none; border-radius: 50%;
            width: 32px; height: 32px; font-size: 1.5rem; cursor: pointer;
        }
        .precos-modal { margin-bottom: 10px; text-align: left; }
        .precos-modal button, .btnMenos, .btnMais, .btnDelSubtotal, #btnEnviarZapSubtotal {
            cursor: pointer; border: none; border-radius: 4px;
        }
        .btnMenos, .btnMais { background: #eee; color: #333; padding: 2px 8px; font-size: 1.1em; }
        .btnAddSubtotal { margin-left: 10px; background: #43a047; color: #fff; padding: 2px 10px; }
        .btnDelSubtotal, #btnEnviarZap, #btnEnviarZapSubtotal { background: #e53935; color: #fff; padding: 2px 8px; }
        .btnDelSubtotal { margin-left: 8px; }
        .qtdInput { width: 40px; text-align: center; margin: 0 5px; }
        .subtotal {
            background: #fff; border-radius: 8px; box-shadow: 0 1px 6px rgba(0,0,0,0.08);
            max-width: 350px; margin: 20px auto 0 auto; padding: 12px;
        }
        .subtotal h3 { margin: 0 0 8px 0; font-size: 1.1rem; }
        .subtotal ul { margin: 0; padding-left: 18px; font-size: 1rem; }
        .subtotal-total { font-weight: bold; margin-top: 8px; }
        @media (max-width: 700px) {
            main { padding: 4px; }
            .pizza-list { flex-direction: column; gap: 12px; }
            article.pizza-card { max-width: 98vw; padding: 10px; }
            .pizza-card img { max-width: 98vw; height: 140px; }
            .subtotal { max-width: 98vw; }
        }
    </style>
</head>
<body>
    <main>
        <h1>ViSa A Melhor Pizzaria</h1>
        <section class="pizza-list" id="pizzaList"></section>
    </main>

    <div class="modal-bg" id="modalBg">
        <div class="modal" id="modalPizza">
            <button class="fechar-modal" id="fecharModal" aria-label="Fechar detalhes">√ó</button>
            <img id="modalImg" src="" alt="">
            <h2 id="modalNome"></h2>
            <div class="precos-modal" id="modalPrecos"></div>
            <div><strong>Ingredientes:</strong><ul id="modalIngredientes"></ul></div>
        </div>
    </div>

    <div class="subtotal" id="subtotalBox" style="display:none;">
        <h3>Subtotal</h3>
        <ul id="subtotalList"></ul>
        <div class="subtotal-total" id="subtotalTotal"></div>
        <button id="btnEnviarZapSubtotal" style="margin-top:10px;background:#25d366;color:#fff;">Enviar Pedido no WhatsApp</button>
    </div>

    <div class="modal-bg" id="modalSubtotalBg">
        <div class="modal" id="modalSubtotal">
            <button class="fechar-modal" id="fecharSubtotalModal" aria-label="Fechar subtotal">√ó</button>
            <h3>Subtotal</h3>
            <ul id="modalSubtotalList"></ul>
            <div class="subtotal-total" id="modalSubtotalTotal"></div>
            <button id="btnAdicionarCarrinho" style="margin:10px 5px 0 0;">Adicionar ao Carrinho</button>
            <button id="btnEnviarZap" style="margin:10px 0 0 5px; background:#25d366; color:#fff;">Enviar Pedido no WhatsApp</button>
        </div>
    </div>

    <script>
    let subtotal = [];

    function mostrarSubtotalModal() {
        const modalBg = document.getElementById('modalSubtotalBg');
        const list = document.getElementById('modalSubtotalList');
        const totalEl = document.getElementById('modalSubtotalTotal');
        list.innerHTML = '';
        let total = 0;
        subtotal.forEach((item, idx) => {
            list.innerHTML += `
                <li>
                    ${item.nome} (${item.tamanho}): R$ ${item.valor}
                    <button type="button" class="btnDelSubtotal" data-idx="${idx}">üóëÔ∏è</button>
                </li>`;
            total += parseFloat(item.valor.replace(',', '.')) || 0;
        });
        totalEl.textContent = "Total: R$ " + total.toFixed(2).replace('.', ',');
        modalBg.classList.add('active');
        document.querySelectorAll('.btnDelSubtotal').forEach(btn => {
            btn.onclick = function() {
                subtotal.splice(this.dataset.idx, 1);
                atualizarSubtotal();
                mostrarSubtotalModal();
            };
        });
    }

    function fecharSubtotalModal() {
        document.getElementById('modalSubtotalBg').classList.remove('active');
    }

    function atualizarSubtotal() {
        const box = document.getElementById('subtotalBox');
        const list = document.getElementById('subtotalList');
        const totalEl = document.getElementById('subtotalTotal');
        if (subtotal.length === 0) {
            box.style.display = 'none';
            return;
        }
        box.style.display = 'block';
        list.innerHTML = '';
        let total = 0;
        subtotal.forEach(item => {
            list.innerHTML += `<li>${item.nome} (${item.tamanho}): R$ ${item.valor}</li>`;
            total += parseFloat(item.valor.replace(',', '.')) || 0;
        });
        totalEl.textContent = "Total: R$ " + total.toFixed(2).replace('.', ',');
    }

    function abrirModal(pizza) {
        const prefix = 'https://visa-pizzaria-backend.onrender.com';
        document.getElementById('modalImg').src = prefix + pizza.imagem;
        document.getElementById('modalImg').alt = pizza.nome;
        document.getElementById('modalNome').textContent = pizza.nome;

        const tamanhos = [
            { nome: 'Pequena', valor: pizza.preco.pequeno },
            { nome: 'M√©dia', valor: pizza.preco.medio },
            { nome: 'Grande', valor: pizza.preco.grande }
        ];
        let html = '';
        tamanhos.forEach((t, i) => {
            html += `
            <div style="display:flex;align-items:center;margin-bottom:8px;">
                <span style="width:80px;"><strong>${t.nome}:</strong> R$ ${t.valor}</span>
                <button class="btnMenos" data-idx="${i}">-</button>
                <input type="number" min="0" value="0" class="qtdInput" data-idx="${i}">
                <button class="btnMais" data-idx="${i}">+</button>
                <button class="btnAddSubtotal" data-idx="${i}">Adicionar</button>
            </div>`;
        });
        document.getElementById('modalPrecos').innerHTML = html;
        document.getElementById('modalIngredientes').innerHTML =
            pizza.ingredientes.split(',').map(i => `<li>${i.trim()}</li>`).join('');
        document.getElementById('modalBg').classList.add('active');

        document.querySelectorAll('.btnMais').forEach(btn => {
            btn.onclick = () => {
                const idx = btn.dataset.idx;
                const inpt = document.querySelector(`.qtdInput[data-idx="${idx}"]`);
                inpt.value = parseInt(inpt.value) + 1;
            };
        });
        document.querySelectorAll('.btnMenos').forEach(btn => {
            btn.onclick = () => {
                const idx = btn.dataset.idx;
                const inpt = document.querySelector(`.qtdInput[data-idx="${idx}"]`);
                inpt.value = Math.max(0, parseInt(inpt.value) - 1);
            };
        });
        document.querySelectorAll('.btnAddSubtotal').forEach(btn => {
            btn.onclick = () => {
                const idx = btn.dataset.idx;
                const inpt = document.querySelector(`.qtdInput[data-idx="${idx}"]`);
                const qtd = parseInt(inpt.value);
                if (qtd > 0) {
                    for (let i = 0; i < qtd; i++) {
                        window.adicionarSubtotal(pizza.nome, tamanhos[idx].nome, tamanhos[idx].valor);
                    }
                } else alert('Escolha uma quantidade maior que zero!');
            };
        });
    }

    window.adicionarSubtotal = function(nome, tamanho, valor) {
        subtotal.push({ nome, tamanho, valor });
        atualizarSubtotal();
        fecharModal();
        mostrarSubtotalModal();
    }

    function fecharModal() {
        document.getElementById('modalBg').classList.remove('active');
    }

    function enviarPedidoZap() {
        if (!subtotal.length) return;
        let msg = "Ol√°! Quero pedir:\n";
        subtotal.forEach(item => msg += `- ${item.nome} (${item.tamanho}): R$ ${item.valor}\n`);
        const total = subtotal.reduce((acc, i) => acc + parseFloat(i.valor.replace(',', '.')), 0);
        msg += "Total: R$ " + total.toFixed(2).replace('.', ',');
        const num = "5511995424085";
        window.open(`https://wa.me/${num}?text=${encodeURIComponent(msg)}`, '_blank');
    }

    async function carregarPizzas() {
        const resp = await fetch('https://visa-pizzaria-backend.onrender.com/api/pizzas');
        const pizzas = await resp.json();
        const pl = document.getElementById('pizzaList');
        pl.innerHTML = '';
        const prefix = 'https://visa-pizzaria-backend.onrender.com';
        pizzas.forEach((pizza, i) => {
            let imgHtml = pizza.imagem
                ? `<img src="${prefix + pizza.imagem}" alt="Pizza ${pizza.nome}" data-idx="${i}">`
                : `<div style="width:240px;height:180px;background:#eee;display:flex;align-items:center;justify-content:center;">Sem imagem</div>`;
            pl.innerHTML += `
                <article class="pizza-card">
                    ${imgHtml}
                    <h2>${pizza.nome}</h2>
                </article>`;
        });
        document.querySelectorAll('.pizza-card img').forEach(img => {
            img.onclick = () => abrirModal(pizzas[img.dataset.idx]);
        });
    }

    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('fecharModal').onclick = fecharModal;
        document.getElementById('modalBg').onclick = e => { if (e.target === e.currentTarget) fecharModal(); };
        document.getElementById('fecharSubtotalModal').onclick = fecharSubtotalModal;
        document.getElementById('modalSubtotalBg').onclick = e => {
            if (e.target === e.currentTarget) fecharSubtotalModal();
        };
        document.getElementById('btnAdicionarCarrinho').onclick = () => {
            fecharSubtotalModal();
            alert('Itens adicionados ao carrinho!');
        };
        document.getElementById('btnEnviarZap').onclick = enviarPedidoZap;
        document.getElementById('btnEnviarZapSubtotal').onclick = enviarPedidoZap;
        carregarPizzas();
    });
    </script>
</body>
</html>
